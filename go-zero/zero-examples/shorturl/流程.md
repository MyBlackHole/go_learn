# install

## install 
```
etcd mysql redis
```

## install 
```
protoc-gen-go:
go install github.com/golang/protobuf/protoc-gen-go@v1.3.2
```

## install 
```
goctl:
GO111MODULE=on go install github.com/zeromicro/go-zero/tools/goctl
```

## create 
```
mkdir -p xxxx/api
go mod init xxxx

```


# api gateway

## http
```
创建:
goctl api -o xxx.api

修改:
type (
	expandReq {
		shorten string `form:"shorten"`
	}

	expandResp {
		url string `json:"url"`
	}
)

type (
	shortenReq {
		url string `form:"url"`
	}

	shortenResp {
		shorten string `json:"shorten"`
	}
)

service shorturl-api {
	@server(
		handler: ShortenHandler
	)
	get /shorten(shortenReq) returns(shortenResp)

	@server(
		handler: ExpandHandler
	)
	get /expand(expandReq) returns(expandResp)
}

生成代码:
goctl api go -api xxx.api -dir .
out:
.
├── api
│   ├── etc
│   │   └── shorturl-api.yaml         // 配置文件
│   ├── internal
│   │   ├── config
│   │   │   └── config.go             // 定义配置
│   │   ├── handler
│   │   │   ├── expandhandler.go      // 实现 expandHandler
│   │   │   ├── routes.go             // 定义路由处理
│   │   │   └── shortenhandler.go     // 实现 shortenHandler
│   │   ├── logic
│   │   │   ├── expandlogic.go        // 实现 ExpandLogic
│   │   │   └── shortenlogic.go       // 实现 ShortenLogic
│   │   ├── svc
│   │   │   └── servicecontext.go     // 定义 ServiceContext
│   │   └── types
│   │       └── types.go              // 定义请求、返回结构体
│   ├── shorturl.api
│   └── shorturl.go                   // main 入口定义
├── go.mod
└── go.sum

运行:
go run shorturl.go -f etc/shorturl-api.yaml
```

## rpc

```
创建:
goctl rpc -o xxx.proto

修改:
syntax = "proto3";

package transform;

option go_package = "./transform";

message expandReq {
    string shorten = 1;
}

message expandResp {
    string url = 1;
}

message shortenReq {
    string url = 1;
}

message shortenResp {
    string shorten = 1;
}

service transformer {
    rpc expand(expandReq) returns(expandResp);
    rpc shorten(shortenReq) returns(shortenResp);
}

生成代码
goctl rpc protoc ./xxx.proto --go_out=. --go-grpc_out=. --zrpc_out=.
out:
rpc/transform
├── etc
│   └── transform.yaml              // configuration file
├── internal
│   ├── config
│   │   └── config.go               // configuration definition
│   ├── logic
│   │   ├── expandlogic.go          // implements expand logic
│   │   └── shortenlogic.go         // implements shorten logic
│   ├── server
│   │   └── transformerserver.go    // rpc handler
│   └── svc
│       └── servicecontext.go       // defines service context, like dependencies
├── transform
│   ├── transform.pb.go
│   └── transform_grpc.pb.go
├── transform.go                    // rpc main entrance
├── transform.proto
└── transformer
    └── transformer.go  

后续
https://github.com/zeromicro/zero-doc/blob/main/doc/shorturl.md
```
